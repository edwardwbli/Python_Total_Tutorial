
# 作用域

## LEGB原则

python的变量作用域遵循LEGB原则,即:

+ L-Local(function)；函数内的名字空间
+ E-Enclosing function locals；外部嵌套函数的名字空间(例如closure)
+ G-Global(module)；函数定义所在模块（文件）的名字空间
+ B-Builtin(Python)；Python内置模块的名字空间

python遵循从上到下的查找方式,我们来看个例子,从闭包中观察LEGB规则.

## global语句

global语句用来在函数内声明一个变量是全局变量


```python
%%writefile acreage.py

from __future__  import print_function
Pi = 3
def acreage(r):
    global Pi
    Pi = 3.14
    return Pi*r**2
def perimeters(r):
    return Pi*r*2
def acreage1(r):
    Pi = 3.1
    return Pi*r**2

if __name__=='__main__':
    print(perimeters(2))
    print(acreage1(2))
    print(acreage(2))
    print(acreage1(2))
    print(perimeters(2))
```

    Overwriting acreage.py



```python
%run acreage.py
```

    12
    12.4
    12.56
    12.4
    12.56


可以看出 acreage中用global声明改变了全局的Pi值,而acreage1中的pi是本地的所以只在本地有效而已

## nolocal语句(3以上独有)

nolocal语句是用来声明一个变量一个变量不是在本地的它常在闭包中使用.

我们知道global声明是明确指定一个变量作用域为模块全局,而nolocal是声明变量在外部嵌套函数的名字空间,这样就可以在local中修改外部嵌套函数中的变量了


```python
X = 1
def a():
    X = 2
    def b():
        X = 3
        print(X)
    return b
a()()
```

    3



```python
X = 1
def a():
    X = 2
    def b():
        global X
        X = 11
        print(X)
    return b
a()()
print(X)
```

    11
    11



```python
%%writefile a.py


X = 1
def a():
    X = 2
    print(X)
    def b():
        nonlocal X
        X = 22
        print(X)
        return X
    b()
    print(X)
    return b
if __name__=='__main__':
    a()()
```

    Overwriting a.py



```python
%run a.py
```

    2
    22
    22
    22


## 突破界限--用字典打破LEGB规则

python中字典是一个神奇的存在,它可以跨界~


```python
%%writefile b.py
from __future__  import print_function
d = {"x":1} 
def a():
    d["x"]+=1
print(d["x"])
a()
print(d["x"])
```

    Overwriting b.py



```python
%run b.py
```

    1
    2



```python
%%writefile c.py
from __future__  import print_function
def a():
    d={"x":1}
    print(d["x"])
    def b():
        d["x"]+=1
        return d["x"]
    b()
    print(d["x"])
    return b
a()
```

    Overwriting c.py



```python
%run c.py
```

    1
    2


## 总结

不论是`global`还是`nonlocal`都是LEGB原则下高级别作用域中修改低级别作用域变量的方法.而在python中也可以用字典来作为迂回跳开LEGB的规则限制.
